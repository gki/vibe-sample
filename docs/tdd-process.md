# TDDプロセスと開発フロー

このドキュメントには、プロジェクトの開発フローとTDD（Test-Driven Development）手法について記載します。

## 開発フロー - TDD (Test-Driven Development)

Kent Beck、t-wada（和田卓人）のTDD手法に基づく開発フローです。

### TDDの基本サイクル: Red → Green → Refactor

1. **Red: 失敗するテストを書く**
   - 実装する前に、期待する動作をテストコードで表現する
   - テストを実行して失敗することを確認（Red）
   - この時点では実装コードは書かない

2. **Green: テストを通す最小限の実装を行う**
   - テストを通すために必要最小限のコードを書く
   - テストが通ることを確認（Green）
   - 綺麗なコードである必要はない（まず動くこと）

3. **Refactor: リファクタリング**
   - テストが通った状態を維持しながら、コードを改善する
   - 重複の削除、可読性の向上、パフォーマンスの改善など
   - リファクタリング後もテストが通ることを確認

### TDDの三原則（Robert C. Martin）

1. **失敗するテストを書くまでプロダクションコードを書いてはならない**
2. **失敗するテストをコンパイルできるようにするまで追加のテストを書いてはならない**
3. **失敗するテストをパスするために必要な以上のプロダクションコードを書いてはならない**

### グリーンバーのルール（t-wada）

- **グリーンバー（テスト成功）の時にコミットする**
  - テストが全て通っている状態でコミット
  - レッドバー（テスト失敗）の状態でコミットしない

### 開発フローの詳細ステップ

1. **タスクの確認**
   - 実装する機能・修正内容を明確にする
   - 必要に応じて`docs/specification.md`を更新
   - テストすべき振る舞いを定義する

2. **ブランチ作成**
   - `feature/`、`fix/`、`hotfix/`プレフィックスを使用
   - ブランチ名は作業内容を明確に（例: `feature/todo-list-component`）

3. **TDDサイクルの実行**
   - **Red**: 失敗するテストを書く
   - **Green**: テストを通す最小限の実装
   - **Refactor**: コードの改善（テストは常にグリーン）
   - このサイクルを小さなステップで繰り返す

4. **コード品質チェック**
   - 全体的: `pnpm lint`（knip + ESLint（API + Web））、`pnpm format`（API + Web）
   - 個別実行も可能: `pnpm lint:api`、`pnpm lint:web`、`pnpm format:api`、`pnpm format:web`
   - knipで未使用コード・依存関係を検出し、クリーンアップ
   - エラーや警告を修正（リファクタリングの一部として）

5. **コミット**
   - **グリーンバー（全テスト成功）の状態でコミット**
   - Conventional Commits形式に従う（詳細は[git-workflow.md](./git-workflow.md)を参照）
   - 小さなコミットを心がける（1つのTDDサイクル = 1つのコミット）

6. **プッシュ・マージ**
   - リモートブランチにプッシュ
   - 必要に応じてプルリクエストを作成

### TDDのベストプラクティス

- **小さなステップで進む**: 一度に多くのことを実装しようとしない
- **テストを先に書く**: 実装コードより先にテストを書く習慣をつける
- **グリーンバーを維持**: リファクタリング中もテストが通る状態を保つ
- **テストの粒度**: 単体テストを中心に、小さな単位でテストを書く（詳細は[testing.md](./testing.md)を参照）
- **失敗の確認**: テストが本当に失敗していることを確認してから実装する

### 実装の優先順位

1. **Phase 1: 基盤セットアップ**（完了）
   - プロジェクト初期化
   - 開発ツール設定

2. **Phase 2: データベース・API**
   - Prisma設定とデータモデル定義
   - GraphQLスキーマ・Resolver実装
   - API動作確認

3. **Phase 3: フロントエンド**
   - Apollo Client設定
   - TODOコンポーネント実装
   - GraphQLクエリ/ミューテーション実装

4. **Phase 4: 統合テスト・ドキュメント**
   - エンドツーエンドテスト
   - ドキュメント整備

