# インフラ・環境関連

このドキュメントには、プロジェクトのインフラストラクチャと環境関連の設定について記載します。

## データベース管理

### SQLite

- データベースファイル（`dev.db`）は`api/`ディレクトリに配置
- `.gitignore`で除外（コミットしない）

### マイグレーション

- Prismaマイグレーションを使用
- スキーマ変更後は必ずマイグレーションを作成: `pnpm prisma:migrate`
- マイグレーションファイルはコミットに含める

### バックアップ

- 本番環境では定期的にデータベースファイルをバックアップ
- 開発環境では必要に応じて手動でバックアップ

### 開発時のデータベース管理

- `pnpm prisma:studio`でPrisma Studioを起動してデータを確認・編集
- 開発中のテストデータは必要に応じて手動で投入

## 環境変数管理

### 環境変数ファイル

- `.env.example`: テンプレートファイル（コミットする）
- `.env`: 実際の環境変数（`.gitignore`で除外）

### 環境変数の命名

- 大文字とアンダースコアを使用（例: `DATABASE_URL`、`API_BASE_URL`）

## 依存関係の管理

- 新しいパッケージ追加時は`pnpm add <package>`を使用
- 不要になったパッケージは削除する
- **knip**を使用して未使用の依存関係を定期的に検出・削除
  - `pnpm lint:knip`で検出結果を確認
  - `pnpm lint`でESLintとknipを同時に実行
- 定期的に依存関係の更新を検討

## knipによるコード品質チェック

**knip**は未使用コード・依存関係を検出するツールです。

### 検出対象

- 未使用のファイル
- 未使用のエクスポート
- 未使用の依存関係（package.jsonに記載されているが実際には使用されていないパッケージ）

### 実行方法

- `pnpm lint`: knipとESLintを同時に実行（推奨）
- `pnpm lint:knip`: knipのみ実行

### 設定

- `knip.config.ts`で検出ルールを調整可能
  - 将来使用予定のファイルは`ignore`に追加可能
  - 設定ファイルで使用される依存関係は`ignoreDependencies`に追加可能

### ベストプラクティス

- コミット前に`pnpm lint`を実行して未使用コードを検出
- 検出された未使用コードは可能な限り削除する（将来使用予定の場合は`knip.config.ts`で無視）
- 定期的にknipを実行してコードベースをクリーンに保つ

