# TODO変更PRD

このドキュメントには、TODO変更機能の要件を定義します。

## 概要（概要情報）

### 1. 機能概要

**機能名**: TODO変更

この機能は、ユーザーが登録済みのTODOのタイトルを変更するための機能です。ユーザーは変更ボタンをクリックして、既存のTODOのタイトルを編集できます。

**機能が提供する価値**: ユーザーが登録済みのTODOの内容を後から修正できるようにします。

### 2. 目的と背景

この機能が解決すべき課題を記述します。

- ユーザーが登録済みのTODOのタイトルを修正できるようにする
- 誤って登録したTODOや、内容が変更されたTODOを更新できるようにする
- 完了済みTODOは編集不可として、完了済みタスクの改ざんを防ぐ

## 詳細（具体的な要件）

### 3. 機能要件

#### 機能一覧

このPRDに含まれる機能：

- **TODO変更**: 登録済みのTODOのタイトルを変更する

#### 各機能の詳細仕様

##### TODO変更

**入力**: 
- ユーザーが未完了TODOの変更ボタンをクリックした操作
- ユーザーが入力した新しいタイトル（文字列）

**出力**: 
- 該当TODOのタイトルが新しいタイトルに更新表示される
- 編集モードが終了する

**処理の流れ**:

1. ユーザーが未完了TODO（`completed: false`）の変更ボタンをクリックする
2. 編集用の入力フィールドを表示する（インライン編集、または`window.prompt()`を使用）
3. ユーザーが新しいタイトルを入力する
4. クライアント側で入力値の検証を行う
5. 検証が成功した場合、APIを通じてTODOのタイトルを更新する
6. 更新成功後、TODO一覧を更新して変更内容を反映する

**条件分岐やエッジケース**:

- 完了済みTODO（`completed: true`）に対しては変更ボタンを非表示または無効化する（編集不可）
- タイトルが空文字の場合: エラーを表示し、更新処理を実行しない
- タイトルが100文字を超える場合: エラーを表示し、更新処理を実行しない
- タイトルに改行文字（`\n`）が含まれる場合: エラーを表示し、更新処理を実行しない
- タイトルにタブ文字（`\t`）が含まれる場合: エラーを表示し、更新処理を実行しない
- 変更処理実行中は、変更ボタンを無効化して連打を防ぐ
- 存在しないIDで変更を試みた場合: エラーメッセージを表示する
- 通信エラーが発生した場合: エラーメッセージを表示する

#### ユーザーインターフェース要件（UI/UX要件）

##### 画面構成やレイアウト

- 各TODO項目に変更ボタンを配置する
- 変更ボタンは、完了ボタン、削除ボタンと並べて配置する
- 完了済みTODO（`completed: true`）の場合は、変更ボタンを非表示または無効化する
- 編集時は、インライン編集を表示するか、`window.prompt()`を使用してタイトルを入力する（共通UI/UXルールに準拠）

##### インタラクションの詳細

- 未完了TODO（`completed: false`）の変更ボタンをクリックすると、編集モードに切り替わる
- 編集モードでは、現在のタイトルを初期値として入力フィールドまたは`window.prompt()`に表示する
- ユーザーが新しいタイトルを入力する
- Enterキーを押下、または確定ボタンをクリックすると、変更処理が実行される
- キャンセル操作（Escキー、またはキャンセルボタン）で編集を中止できる
- 変更処理実行中は、変更ボタンまたは確定ボタンを無効化（`disabled`属性を設定）し、ローディングインジケータを表示する

##### 表示条件や状態遷移

- 初期状態（未完了）: 変更ボタンは有効で表示される
- 編集モード: 入力フィールドまたは`window.prompt()`が表示される
- 変更処理中: 変更ボタンまたは確定ボタンは無効化、ローディングインジケータを表示
- 変更完了後: 編集モードを終了し、更新されたタイトルを表示

##### 共通UI/UXルールへの準拠状況

本機能は共通UI/UXルール（`prd-common.md`）に準拠します。

#### データ要件

##### 必要なデータ項目

- 入力データ:
  - `id`: TODOの一意な識別子（整数、必須）
  - `title`: TODOのタイトル（文字列、必須、1文字以上100文字以下、改行・タブ文字不可）

- 出力データ（更新されたTODO）:
  - `id`: TODOの一意な識別子（整数）
  - `title`: TODOのタイトル（文字列、更新後の値）
  - `completed`: 完了状態（真偽値、変更されない）
  - `createdAt`: 作成日時（文字列、ISO 8601形式、変更されない）
  - `updatedAt`: 更新日時（文字列、ISO 8601形式、更新時刻に更新される）

##### データの形式や制約

- `title`の制約:
  - 必須項目
  - 1文字以上100文字以下
  - 改行文字（`\n`）を含んではならない
  - タブ文字（`\t`）を含んではならない
  - 前後の空白文字は許可する（トリムは行わない）

- `id`は必須項目であり、存在する未完了TODOのIDでなければならない
- 完了済みTODO（`completed: true`）は編集不可

##### データの保存方法や取得方法

- データ送信: APIを通じてTODOのタイトルを更新する
- 更新後、TODO一覧を再取得するか、リアルタイムで表示を更新する

#### ビジネス上発生が想定されるエラーパターン

##### ビジネスロジック上のエラーケース

- **タイトルが空文字の場合**:
  - 変更操作を実行した際に検証エラーとして検出する
  - エラーメッセージ: "タイトルを入力してください。"
  - 表示方法: `window.alert()`で表示する（共通UI/UXルールに準拠）

- **タイトルが100文字を超える場合**:
  - 変更操作を実行した際に検証エラーとして検出する
  - エラーメッセージ: "タイトルは100文字以内で入力してください。"
  - 表示方法: `window.alert()`で表示する

- **タイトルに改行文字が含まれる場合**:
  - 変更操作を実行した際に検証エラーとして検出する
  - エラーメッセージ: "タイトルに改行を含めることはできません。"
  - 表示方法: `window.alert()`で表示する

- **タイトルにタブ文字が含まれる場合**:
  - 変更操作を実行した際に検証エラーとして検出する
  - エラーメッセージ: "タイトルにタブを含めることはできません。"
  - 表示方法: `window.alert()`で表示する

- **完了済みTODOへの編集試行**:
  - 完了済みTODO（`completed: true`）に対しては変更ボタンを非表示または無効化する
  - ユーザーが完了済みTODOに対して変更操作を行うことはできない

##### ユーザー操作によるエラーケース

- **変更ボタンの連打**:
  - 変更処理実行中は変更ボタンまたは確定ボタンを無効化することで防止する
  - 処理が完了するまで、同じTODOの二重変更を防ぐ

##### 通信エラーケース

- **API通信エラー**:
  - API通信エラーが発生した場合、共通UI/UXルールに従い`window.alert()`でエラーメッセージを表示する
  - エラーメッセージ例: "TODOの変更に失敗しました。しばらく時間をおいて再度お試しください。"

- **存在しないIDでの変更**:
  - 存在しないIDで変更を試みた場合、共通UI/UXルールに従い`window.alert()`でエラーメッセージを表示する
  - エラーメッセージ例: "指定されたTODOが見つかりませんでした。"

### 4. 制約事項と前提条件

#### 制約事項

- 認証・認可機能はサンプルアプリのためスコープ外とする
- タイトルの文字数上限は100文字とする
- 改行文字とタブ文字は許可しない
- 完了済みTODO（`completed: true`）は編集不可

#### 前提条件

前提条件は特にありません。

## 参考情報（補足情報）

### 5. 関連するPRD

#### 依存している機能PRD（この機能が動作するために必要な機能）

- `prd-todo-display.md`: TODO表示機能（変更ボタンを配置する画面）

#### 影響を受ける機能PRD（この機能の実装により変更が必要な機能）

- なし（変更機能はTODO表示上の一操作であるため、他の機能に影響を与えることはない）

#### 共通PRD

- `prd-common.md`: 対象ユーザー、用語集、共通UI/UXルールを参照

