# TODO完了登録PRD

このドキュメントには、TODO完了登録機能の要件を定義します。

## 概要（概要情報）

### 1. 機能概要

**機能名**: TODO完了登録

この機能は、ユーザーが未完了のTODOを完了済みとして登録するための機能です。ユーザーは完了ボタンをクリックすることで、該当TODOの完了状態を更新できます。

**機能が提供する価値**: ユーザーが完了したタスクを明確にマークし、TODOの進捗を管理できるようにします。

### 2. 目的と背景

この機能が解決すべき課題を記述します。

- ユーザーが完了したタスクを明確にマークできるようにする
- TODOの完了状態を視覚的に管理できるようにする
- 完了済みTODOと未完了TODOを区別できるようにする

## 詳細（具体的な要件）

### 3. 機能要件

#### 機能一覧

このPRDに含まれる機能：

- **TODO完了登録**: 未完了のTODOを完了済みとして登録する

#### 各機能の詳細仕様

##### TODO完了登録

**入力**: 
- ユーザーが未完了TODOの完了ボタンをクリックした操作

**出力**: 
- 該当TODOが完了状態（視覚的に完了を示す表示）になる
- 該当TODOがリストの下部に移動する

**処理の流れ**:

1. ユーザーが未完了TODOの完了ボタンをクリックする
2. APIを通じてTODOの完了状態を`completed: true`に更新する
3. 更新成功後、TODO一覧を更新して完了状態を反映する（完了TODOはリストの下部に移動する）
4. 完了状態の変更を視覚的に表示する

**条件分岐やエッジケース**:

- 完了処理実行中は、完了ボタンを無効化して連打を防ぐ
- 既に完了済み（`completed: true`）のTODOに対しては完了ボタンを非表示または無効化する
- 存在しないIDで完了登録を試みた場合: エラーメッセージを表示する
- 通信エラーが発生した場合: エラーメッセージを表示する

#### ユーザーインターフェース要件（UI/UX要件）

##### 画面構成やレイアウト

- 各TODO項目に完了ボタンを配置する
- 完了ボタンは、変更ボタン、削除ボタンと並べて配置する
- 完了済みTODO（`completed: true`）の場合は、完了ボタンを非表示または無効化する

##### インタラクションの詳細

- 未完了TODO（`completed: false`）の完了ボタンをクリックすると、完了登録処理が実行される
- 完了処理実行中は、完了ボタンを無効化（`disabled`属性を設定）し、ローディングインジケータを表示する
- 完了処理完了後、該当TODOは完了状態に更新され、リストの下部に移動する

##### 表示条件や状態遷移

- 初期状態（未完了）: 完了ボタンは有効で表示される
- 完了処理中: 完了ボタンは無効化、ローディングインジケータを表示
- 完了後: 完了ボタンは非表示または無効化される、TODOはリストの下部に移動

##### 共通UI/UXルールへの準拠状況

本機能は共通UI/UXルール（`prd-common.md`）に準拠します。

#### データ要件

##### 必要なデータ項目

- 入力データ:
  - `id`: TODOの一意な識別子（整数、必須）

- 出力データ（更新されたTODO）:
  - `id`: TODOの一意な識別子（整数）
  - `title`: TODOのタイトル（文字列）
  - `completed`: 完了状態（真偽値、`true`に更新される）
  - `createdAt`: 作成日時（文字列、ISO 8601形式）
  - `updatedAt`: 更新日時（文字列、ISO 8601形式、更新時刻に更新される）

##### データの形式や制約

- `id`は必須項目であり、存在するTODOのIDでなければならない
- `completed`フィールドを`true`に更新する

##### データの保存方法や取得方法

- データ送信: APIを通じてTODOの完了状態を更新する
- 更新後、TODO一覧を再取得するか、リアルタイムで表示を更新する

#### ビジネス上発生が想定されるエラーパターン

##### ビジネスロジック上のエラーケース

- なし（完了登録機能は単純に状態を更新するのみのため、ビジネスロジックエラーは発生しない）

##### ユーザー操作によるエラーケース

- **完了ボタンの連打**:
  - 完了処理実行中は完了ボタンを無効化することで防止する
  - 処理が完了するまで、同じTODOの二重完了登録を防ぐ

- **既に完了済みTODOへの操作**:
  - 完了済みTODO（`completed: true`）に対しては完了ボタンを非表示または無効化する
  - ユーザーが完了済みTODOに対して完了操作を行うことはできない

##### 通信エラーケース

- **API通信エラー**:
  - API通信エラーが発生した場合、共通UI/UXルールに従い`window.alert()`でエラーメッセージを表示する
  - エラーメッセージ例: "TODOの完了登録に失敗しました。しばらく時間をおいて再度お試しください。"

- **存在しないIDでの完了登録**:
  - 存在しないIDで完了登録を試みた場合、共通UI/UXルールに従い`window.alert()`でエラーメッセージを表示する
  - エラーメッセージ例: "指定されたTODOが見つかりませんでした。"

### 4. 制約事項と前提条件

#### 制約事項

- 認証・認可機能はサンプルアプリのためスコープ外とする
- 完了済みTODO（`completed: true`）に対しては完了操作を行えない

#### 前提条件

前提条件は特にありません。

## 参考情報（補足情報）

### 5. 関連するPRD

#### 依存している機能PRD（この機能が動作するために必要な機能）

- `prd-todo-display.md`: TODO表示機能（完了ボタンを配置する画面）

#### 影響を受ける機能PRD（この機能の実装により変更が必要な機能）

- なし（完了登録はTODO表示上の一操作であるため、他の機能に影響を与えることはない）

#### 共通PRD

- `prd-common.md`: 対象ユーザー、用語集、共通UI/UXルールを参照
