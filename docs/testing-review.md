# テストレビュー

このドキュメントには、プロジェクトのテストレビューの基準を記載します。

## レビューの目的

テストレビューは、テストコードの品質を確保し、適切なテスト戦略の実現を促進するために実施します。適切なレビューにより、以下の効果が期待できます：

- テストの網羅性と品質の向上
- テストの保守性の向上
- テストの実行速度と効率の向上
- テスト戦略の一貫性の確保

## レビューの基準

### 静的コードチェックのレビュー観点

- **ESLintルールへの準拠**: コードがESLintルールに準拠しているか
- **未使用コードの有無**: knipによる未使用コード・依存関係の検出結果を確認
- **型安全性**: TypeScriptの型チェックが適切に行われているか（`any`型の使用回避など）

### 単体テストのレビュー観点

- **テストの網羅性**: 正常系、異常系、境界値、エッジケースが適切にカバーされているか
- **モックの適切性**: 依存関係が適切にモックされているか、モックが過度に複雑でないか
- **AAAパターンの遵守**: Arrange、Act、Assertの構造が明確か
- **冪等性**: 繰り返し実施しても同じ結果を返すか

### 統合テストのレビュー観点

- **テスト環境の適切性**: 実際のデータベースやAPIを使用した適切なテスト環境が構築されているか
- **クリーンアップの実施**: テスト前後のデータクリーンアップが適切に実施されているか
- **エラーハンドリングの検証**: エラーケースが適切に検証されているか
- **統合テストで実施していることを単体テストで検証済みでないか**: 統合テストで実施している内容が、より前段の単体テストで検証可能な場合は、単体テストに移行すべき
- **冪等性**: 繰り返し実施しても同じ結果を返すか
- **データのセットアップとクリーンアップの適切さ**: テストデータの準備と後処理が適切に行われているか

### E2Eテストのレビュー観点

- **ユーザーフローの網羅性**: 主要なユーザーフローが適切にカバーされているか
- **テストの安定性**: テストが安定して実行できるか（フレーキーテストの回避）
- **実行時間の適切性**: テストの実行時間が適切か
- **E2Eテストでテストしている観点が単体テストや統合テストで検証済みでないか**: E2Eテストで実施している内容が、より前段の単体テストや統合テストで検証可能な場合は、前段のテストに移行すべき
- **冪等性**: 繰り返し実施しても同じ結果を返すか
- **データのセットアップとクリーンアップの適切さ**: テストデータの準備と後処理が適切に行われているか

## 必須チェック項目

### 静的コードチェックの必須項目

- [ ] コードがESLintルールに準拠しているか（`pnpm lint`が通るか）
- [ ] 未使用コード・依存関係がないか（knipで検出、詳細は[infrastructure.md](./infrastructure.md)を参照）
- [ ] 型安全性が保たれているか（`any`型の使用回避など、詳細は[coding-standards.md](./coding-standards.md)を参照）

### 単体テストの必須項目

- [ ] テストファイルが適切な場所に配置されているか（対象ファイルと同じディレクトリ）
- [ ] テストファイル名が適切か（`.test.ts`または`.test.tsx`）
- [ ] AAAパターン（Arrange、Act、Assert）に従っているか
- [ ] 正常系、異常系、境界値、エッジケースが適切にカバーされているか
- [ ] モックが適切に使用されているか（依存関係の分離）
- [ ] テストが独立しているか（他のテストに依存しない）
- [ ] テストが冪等性を持っているか（繰り返し実施しても同じ結果を返す）
- [ ] テスト用helper関数が`__tests__/helpers/`ディレクトリに配置されているか（使用している場合）

### 統合テストの必須項目

- [ ] テストファイルが適切な場所に配置されているか（対象ファイルと同じディレクトリ）
- [ ] テストファイル名が適切か（`.integration.test.ts`）
- [ ] 実際のデータベースやAPIを使用したテスト環境が構築されているか
- [ ] テスト前後のデータクリーンアップが適切に実施されているか（`beforeAll`、`afterAll`、`beforeEach`、`afterEach`の使用）
- [ ] エラーハンドリングが適切に検証されているか
- [ ] 統合テストで実施していることを単体テストで検証済みでないか（重複チェック）
- [ ] テストが冪等性を持っているか（繰り返し実施しても同じ結果を返す）
- [ ] データのセットアップとクリーンアップが適切に行われているか
- [ ] テスト用helper関数が`__tests__/helpers/`ディレクトリに配置されているか（使用している場合）

### E2Eテストの必須項目

- [ ] テストファイルがプロジェクトルートの`e2e/`ディレクトリに配置されているか
- [ ] テストファイル名が適切か（`.test.ts`）
- [ ] 機能ごとにディレクトリが分割されているか（例: `e2e/todo/`、`e2e/auth/`）
- [ ] ユーザーフロー単位でテストが作成されているか
- [ ] テストが安定して実行できるか（フレーキーテストの回避）
- [ ] テストの実行時間が適切か
- [ ] E2Eテストでテストしている観点が単体テストや統合テストで検証済みでないか（重複チェック）
- [ ] テストが冪等性を持っているか（繰り返し実施しても同じ結果を返す）
- [ ] データのセットアップとクリーンアップが適切に行われているか
- [ ] テスト用helper関数が`e2e/helpers/`ディレクトリに配置されているか（使用している場合）

## テスト実装ルールの確認

レビュー時には、[testing.md](./testing.md)に記載されているテスト実装のルールに準拠しているかも確認します：

- 格納フォルダのルール
- ファイル名のルール
- 作成単位のルール
- テスト用helper関数の配置ルール

